<ion-header>
  <ion-toolbar>
    <ion-title>Momentum</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Primary CTA -->
  <ion-button expand="block" size="large" class="start-session-btn" routerLink="/start-session">
    Start Session
  </ion-button>

  <!-- Loading State -->
  <ng-container *ngIf="isLoading">
    <ion-card class="status-card">
      <ion-card-content>
        <ion-skeleton-text animated style="width: 40%; height: 24px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 60%; height: 16px; margin-top: 8px;"></ion-skeleton-text>
      </ion-card-content>
    </ion-card>
  </ng-container>

  <!-- Momentum Status -->
  <ng-container *ngIf="!isLoading && momentum">
    <ion-card class="status-card momentum-card">
      <ion-card-content>
        <div class="momentum-header">
          <span class="momentum-label">Momentum</span>
          <span
            class="momentum-status"
            [class.active]="momentum.status === 'Active'"
            [class.paused]="momentum.status === 'Paused'"
          >
            {{ momentum.status }}
          </span>
        </div>

        <div class="momentum-details">
          <p class="days-remaining">{{ formatDaysRemaining(momentum.daysRemaining) }}</p>
          <p class="last-session" *ngIf="momentum.lastSessionDate">
            Last session: {{ formatDate(momentum.lastSessionDate) }}
          </p>
          <p class="last-session" *ngIf="!momentum.lastSessionDate">
            No sessions yet
          </p>
        </div>
      </ion-card-content>
    </ion-card>
  </ng-container>

  <!-- No Momentum Data (edge case) -->
  <ng-container *ngIf="!isLoading && !momentum">
    <ion-card class="status-card">
      <ion-card-content>
        <p class="empty-momentum">Start a session to begin tracking your momentum.</p>
      </ion-card-content>
    </ion-card>
  </ng-container>

  <!-- Recent Sessions -->
  <div class="section-header">
    <h2>Recent Sessions</h2>
  </div>

  <!-- Loading Sessions -->
  <ng-container *ngIf="isLoading">
    <ion-list class="sessions-list">
      <ion-item *ngFor="let i of [1, 2, 3]">
        <ion-label>
          <ion-skeleton-text animated style="width: 50%;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 70%; margin-top: 4px;"></ion-skeleton-text>
        </ion-label>
      </ion-item>
    </ion-list>
  </ng-container>

  <!-- Sessions List -->
  <ng-container *ngIf="!isLoading">
    <ion-list *ngIf="recentSessions.length > 0" class="sessions-list">
      <ion-item
        *ngFor="let session of recentSessions"
        button
        detail="true"
        (click)="viewSession(session)"
      >
        <ion-label>
          <h3>{{ formatFullDate(session.endedAt) }}</h3>
          <p *ngIf="getDuration(session) as duration">{{ duration }} min</p>
        </ion-label>
      </ion-item>
    </ion-list>

    <!-- Empty State -->
    <div *ngIf="recentSessions.length === 0" class="empty-sessions">
      <p>No completed sessions yet.</p>
    </div>
  </ng-container>
</ion-content>
