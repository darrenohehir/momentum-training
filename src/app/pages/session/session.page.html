<ion-header>
  <ion-toolbar>
    <ion-title>Session In Progress</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Loading State -->
  <ng-container *ngIf="isLoading">
    <div class="loading-state">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Loading session...</p>
    </div>
  </ng-container>

  <!-- Error State -->
  <ng-container *ngIf="!isLoading && loadError">
    <div class="error-state">
      <ion-icon name="alert-circle-outline"></ion-icon>
      <h2>Session not found</h2>
      <p>Unable to load this session.</p>
      <ion-button routerLink="/tabs/home" fill="outline">
        Return Home
      </ion-button>
    </div>
  </ng-container>

  <!-- Session Info -->
  <ng-container *ngIf="!isLoading && !loadError && session">
    <ion-card class="session-info-card">
      <ion-card-header>
        <ion-card-subtitle>
          {{ formatStartDate(session.startedAt) }}
        </ion-card-subtitle>
        <ion-card-title>
          Started at {{ formatStartTime(session.startedAt) }}
        </ion-card-title>
      </ion-card-header>
      <ion-card-content *ngIf="getQuestLabel(session.questId) as questLabel">
        <ion-chip>
          <ion-icon name="fitness-outline"></ion-icon>
          <ion-label>{{ questLabel }}</ion-label>
        </ion-chip>
      </ion-card-content>
    </ion-card>

    <!-- Exercises Section -->
    <div class="exercises-section">
      <div class="section-header">
        <h2>Exercises</h2>
        <span class="exercise-count" *ngIf="sessionExercises.length > 0">
          {{ sessionExercises.length }}
        </span>
      </div>

      <!-- Loading exercises -->
      <div *ngIf="isLoadingExercises" class="ion-padding-vertical">
        <ion-list>
          <ion-item *ngFor="let i of [1,2]">
            <ion-label>
              <h2><ion-skeleton-text animated style="width: 60%"></ion-skeleton-text></h2>
              <p><ion-skeleton-text animated style="width: 40%"></ion-skeleton-text></p>
            </ion-label>
          </ion-item>
        </ion-list>
      </div>

      <!-- Exercise List -->
      <ion-list *ngIf="!isLoadingExercises && sessionExercises.length > 0" class="exercise-list">
        <ion-item *ngFor="let item of sessionExercises; let i = index">
          <ion-label>
            <h2>{{ item.exercise.name }}</h2>
            <p>{{ formatCategory(item.exercise.category) }}</p>
          </ion-label>
          <ion-note slot="end" class="exercise-index">{{ i + 1 }}</ion-note>
        </ion-item>
      </ion-list>

      <!-- Empty State -->
      <div *ngIf="!isLoadingExercises && sessionExercises.length === 0" class="exercises-empty">
        <ion-icon name="barbell-outline"></ion-icon>
        <p>No exercises added yet</p>
      </div>

      <!-- Add Exercise Button -->
      <ion-button
        expand="block"
        fill="outline"
        class="add-exercise-button"
        (click)="openExercisePicker()"
      >
        <ion-icon slot="start" name="add-outline"></ion-icon>
        Add Exercise
      </ion-button>
    </div>
  </ng-container>
</ion-content>
