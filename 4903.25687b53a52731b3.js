"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4903],{4903:(Y,P,l)=>{l.r(P),l.d(P,{InsightsPageModule:()=>z});var u=l(2200),r=l(7343),k=l(8132),M=l(467),t=l(3664),h=l(2615),O=l(6057),x=l(8012);function y(e,s){1&e&&(t.qex(0),t.j41(1,"div",2),t.nrm(2,"ion-spinner",3),t.j41(3,"p"),t.EFF(4,"Loading..."),t.k0s()(),t.bVm())}function I(e,s){1&e&&(t.j41(0,"span"),t.EFF(1," \xb7 "),t.k0s())}function w(e,s){if(1&e&&(t.j41(0,"span"),t.EFF(1),t.DNE(2,I,2,0,"span",1),t.k0s()),2&e){const i=s.$implicit,n=s.last;t.R7$(),t.SpI(" ",i.count),t.R7$(),t.Y8G("ngIf",!n)}}function v(e,s){if(1&e&&(t.j41(0,"div",19),t.DNE(1,w,3,2,"span",20),t.k0s()),2&e){const i=t.XpG(3);t.R7$(),t.Y8G("ngForOf",i.weeklyBreakdown)}}function F(e,s){1&e&&(t.j41(0,"div",13),t.EFF(1,"\u2014"),t.k0s())}function R(e,s){if(1&e&&(t.j41(0,"div",21),t.EFF(1),t.k0s()),2&e){const i=t.XpG(3);t.R7$(),t.Lme("",i.recentPRs.length," ",1===i.recentPRs.length?"record":"records")}}function D(e,s){if(1&e&&(t.j41(0,"div",26)(1,"div",27),t.EFF(2),t.k0s(),t.j41(3,"div",28)(4,"span",29),t.EFF(5),t.k0s(),t.j41(6,"span",30),t.EFF(7),t.k0s()()()),2&e){const i=s.$implicit,n=t.XpG(4);t.R7$(2),t.JRh(i.exerciseName),t.R7$(3),t.SpI("",i.newMax," kg"),t.R7$(2),t.JRh(n.formatShortDate(i.detectedAt))}}function E(e,s){if(1&e&&(t.j41(0,"div",22)(1,"h3",23),t.EFF(2,"Recent top weights"),t.k0s(),t.j41(3,"div",24),t.DNE(4,D,8,3,"div",25),t.k0s()()),2&e){const i=t.XpG(3);t.R7$(4),t.Y8G("ngForOf",i.recentPRs)}}function j(e,s){if(1&e&&(t.j41(0,"section",8)(1,"h2",9),t.EFF(2,"Insights"),t.k0s(),t.j41(3,"div",10)(4,"ion-card",11)(5,"ion-card-content")(6,"div",12),t.EFF(7,"Last 4 weeks"),t.k0s(),t.j41(8,"div",13),t.EFF(9),t.k0s(),t.DNE(10,v,2,1,"div",14),t.k0s()(),t.j41(11,"ion-card",15)(12,"ion-card-content")(13,"div",12),t.EFF(14,"Top weights"),t.k0s(),t.DNE(15,F,2,0,"div",16)(16,R,2,2,"div",17),t.k0s()()(),t.DNE(17,E,5,1,"div",18),t.k0s()),2&e){const i=t.XpG(2);t.R7$(9),t.Lme("",i.sessionsLast4Weeks," ",1===i.sessionsLast4Weeks?"session":"sessions"),t.R7$(),t.Y8G("ngIf",i.weeklyBreakdown.length>0),t.R7$(5),t.Y8G("ngIf",0===i.recentPRs.length),t.R7$(),t.Y8G("ngIf",i.recentPRs.length>0),t.R7$(),t.Y8G("ngIf",i.recentPRs.length>0)}}function b(e,s){1&e&&(t.j41(0,"h2",9),t.EFF(1,"Sessions"),t.k0s())}function $(e,s){1&e&&(t.j41(0,"div",31),t.nrm(1,"ion-icon",32),t.j41(2,"h2"),t.EFF(3,"No sessions yet"),t.k0s(),t.j41(4,"p"),t.EFF(5,"Completed sessions will appear here."),t.k0s()())}function G(e,s){if(1&e&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&e){const i=s.ngIf;t.R7$(),t.SpI(" \xb7 ",i," min")}}function S(e,s){if(1&e){const i=t.RV6();t.j41(0,"ion-item",34),t.bIt("click",function(){const o=h.eBV(i).$implicit,c=t.XpG(3);return h.Njj(c.viewSession(o))}),t.j41(1,"ion-label")(2,"h2"),t.EFF(3),t.k0s(),t.j41(4,"p"),t.EFF(5),t.DNE(6,G,2,1,"span",1),t.k0s()()()}if(2&e){const i=s.$implicit,n=t.XpG(3);t.R7$(3),t.JRh(n.getQuestName(i)),t.R7$(2),t.SpI(" ",n.formatDate(i.endedAt)," "),t.R7$(),t.Y8G("ngIf",n.getDuration(i))}}function T(e,s){if(1&e&&(t.j41(0,"ion-list"),t.DNE(1,S,7,3,"ion-item",33),t.k0s()),2&e){const i=t.XpG(2);t.R7$(),t.Y8G("ngForOf",i.sessions)}}function L(e,s){if(1&e&&(t.qex(0),t.DNE(1,j,18,6,"section",4),t.j41(2,"section",5),t.DNE(3,b,2,0,"h2",6)(4,$,6,0,"div",7)(5,T,2,1,"ion-list",1),t.k0s(),t.bVm()),2&e){const i=t.XpG();t.R7$(),t.Y8G("ngIf",i.sessions.length>0),t.R7$(2),t.Y8G("ngIf",i.sessions.length>0),t.R7$(),t.Y8G("ngIf",0===i.sessions.length),t.R7$(),t.Y8G("ngIf",i.sessions.length>0)}}const C={quick:"Quick Session","full-body":"Full Body",upper:"Upper Body",lower:"Lower Body"},B=[{path:"",component:(()=>{var e;class s{constructor(n,o){this.db=n,this.router=o,this.sessions=[],this.isLoading=!0,this.sessionsLast4Weeks=0,this.weeklyBreakdown=[],this.recentPRs=[]}ngOnInit(){}ionViewWillEnter(){var n=this;return(0,M.A)(function*(){yield n.loadSessions()})()}loadSessions(){var n=this;return(0,M.A)(function*(){n.isLoading=!0;try{const o=new Date;o.setDate(o.getDate()-28);const[c,d,p]=yield Promise.all([n.db.getCompletedSessions(),n.db.getCompletedSessionsSince(o),n.db.getRecentPREvents(10)]);if(n.sessions=c,n.calculateWeeklyInsights(d),p.length>0){const f=[...new Set(p.map(g=>g.exerciseId))],a=yield n.db.getExercisesByIds(f);n.recentPRs=p.map(g=>({...g,exerciseName:a.get(g.exerciseId)?.name||"Unknown Exercise"}))}else n.recentPRs=[]}catch(o){console.error("Failed to load history data:",o),n.sessions=[],n.sessionsLast4Weeks=0,n.weeklyBreakdown=[],n.recentPRs=[]}finally{n.isLoading=!1}})()}calculateWeeklyInsights(n){const c=this.getMondayOfWeek(new Date),d=[];for(let a=0;a<4;a++){const g=new Date(c);g.setDate(g.getDate()-7*a);const _=new Date(g);_.setDate(_.getDate()+7),d.push({start:g,end:_,label:0===a?"This week":1===a?"Last week":`${a} weeks ago`})}const p=d.map(a=>({weekLabel:a.label,count:0}));let f=0;for(const a of n){if(!a.endedAt)continue;const g=new Date(a.endedAt);for(let _=0;_<d.length;_++){const m=d[_];if(g>=m.start&&g<m.end){p[_].count++,f++;break}}}this.sessionsLast4Weeks=f,this.weeklyBreakdown=p}getMondayOfWeek(n){const o=new Date(n),c=o.getDay(),d=0===c?6:c-1;return o.setDate(o.getDate()-d),o.setHours(0,0,0,0),o}viewSession(n){this.router.navigate(["/history",n.id])}formatDate(n){return new Date(n).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}formatShortDate(n){return new Date(n).toLocaleDateString([],{month:"short",day:"numeric"})}getDuration(n){if(!n.startedAt||!n.endedAt)return null;const o=new Date(n.startedAt).getTime(),c=new Date(n.endedAt).getTime(),d=Math.round((c-o)/6e4);return Math.max(1,d)}getQuestName(n){return n.questId&&C[n.questId]?C[n.questId]:"Session"}static#t=e=()=>(this.\u0275fac=function(o){return new(o||s)(t.rXU(O.at),t.rXU(x.Ix))},this.\u0275cmp=t.VBU({type:s,selectors:[["app-insights"]],standalone:!1,decls:7,vars:2,consts:[[1,"ion-padding"],[4,"ngIf"],[1,"loading-state"],["name","crescent"],["class","insights-section",4,"ngIf"],[1,"history-section"],["class","section-title",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"insights-section"],[1,"section-title"],[1,"insights-cards"],[1,"insight-card","workouts-card"],[1,"insight-label"],[1,"insight-value"],["class","weekly-breakdown",4,"ngIf"],[1,"insight-card","prs-card"],["class","insight-value",4,"ngIf"],["class","pr-count",4,"ngIf"],["class","pr-list-section",4,"ngIf"],[1,"weekly-breakdown"],[4,"ngFor","ngForOf"],[1,"pr-count"],[1,"pr-list-section"],[1,"subsection-title"],[1,"pr-list"],["class","pr-item",4,"ngFor","ngForOf"],[1,"pr-item"],[1,"pr-exercise"],[1,"pr-details"],[1,"pr-weight"],[1,"pr-date"],[1,"empty-state"],["name","calendar-outline"],["button","","detail","true",3,"click",4,"ngFor","ngForOf"],["button","","detail","true",3,"click"]],template:function(o,c){1&o&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"History"),t.k0s()()(),t.j41(4,"ion-content",0),t.DNE(5,y,5,0,"ng-container",1)(6,L,6,4,"ng-container",1),t.k0s()),2&o&&(t.R7$(5),t.Y8G("ngIf",c.isLoading),t.R7$(),t.Y8G("ngIf",!c.isLoading))},dependencies:[u.Sq,u.bT,r.b_,r.I9,r.W9,r.eU,r.iq,r.uz,r.he,r.nf,r.w2,r.BC,r.ai],styles:[".loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:48px 24px;height:60%}.loading-state[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-bottom:16px}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{opacity:.6}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:48px 24px;height:60%}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;opacity:.2;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 8px;font-size:1.25rem;font-weight:600}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;opacity:.5;font-size:.9rem}.section-title[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;opacity:.6;margin:0 0 12px}.insights-section[_ngcontent-%COMP%]{margin-bottom:24px}.insights-cards[_ngcontent-%COMP%]{display:flex;gap:12px}.insights-cards[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]{flex:1;margin:0}.insights-cards[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:14px 16px}.insights-cards[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .insight-label[_ngcontent-%COMP%]{font-size:.75rem;opacity:.5;margin-bottom:4px}.insights-cards[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .insight-value[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500}.insights-cards[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .weekly-breakdown[_ngcontent-%COMP%]{margin-top:6px;font-size:.75rem;opacity:.5;font-family:IBM Plex Mono,monospace}.insights-cards[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .pr-count[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500}.pr-list-section[_ngcontent-%COMP%]{margin-top:16px}.pr-list-section[_ngcontent-%COMP%]   .subsection-title[_ngcontent-%COMP%]{font-size:.8rem;font-weight:500;opacity:.5;margin:0 0 10px}.pr-list[_ngcontent-%COMP%]   .pr-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:var(--ion-color-step-100);border-radius:6px;margin-bottom:6px}.pr-list[_ngcontent-%COMP%]   .pr-item[_ngcontent-%COMP%]   .pr-exercise[_ngcontent-%COMP%]{font-size:.9rem;font-weight:500}.pr-list[_ngcontent-%COMP%]   .pr-item[_ngcontent-%COMP%]   .pr-details[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.pr-list[_ngcontent-%COMP%]   .pr-item[_ngcontent-%COMP%]   .pr-details[_ngcontent-%COMP%]   .pr-weight[_ngcontent-%COMP%]{font-size:.9rem;font-family:IBM Plex Mono,monospace}.pr-list[_ngcontent-%COMP%]   .pr-item[_ngcontent-%COMP%]   .pr-details[_ngcontent-%COMP%]   .pr-date[_ngcontent-%COMP%]{font-size:.8rem;opacity:.5}.history-section[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{background:transparent}.history-section[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: var(--ion-color-step-100);margin-bottom:8px;border-radius:8px}.history-section[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;margin:0}.history-section[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem;opacity:.6;margin:4px 0 0}"]}))}return e(),s})()}];let N=(()=>{var e;class s{static#t=e=()=>(this.\u0275fac=function(o){return new(o||s)},this.\u0275mod=t.$C({type:s}),this.\u0275inj=h.G2t({imports:[k.iI.forChild(B),k.iI]}))}return e(),s})(),z=(()=>{var e;class s{static#t=e=()=>(this.\u0275fac=function(o){return new(o||s)},this.\u0275mod=t.$C({type:s}),this.\u0275inj=h.G2t({imports:[u.MD,r.bv,N]}))}return e(),s})()}}]);